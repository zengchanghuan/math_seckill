# iOS 真机调试网络配置指南

## 问题：No route to host (errno = 65)

当 iPhone 真机无法连接到 Mac 上的后端服务器时，通常是因为路由器开启了"AP 隔离"（客户端隔离）功能。

## 解决方案

### 方案 1：使用 Mac 热点（推荐 ⭐）

这是最可靠的开发调试方法：

1. **在 Mac 上创建热点**：
   - 系统设置 → 通用 → 共享 → 互联网共享
   - 选择"通过 Wi-Fi 共享连接"
   - 设置热点名称和密码
   - 启用"互联网共享"

2. **iPhone 连接 Mac 热点**：
   - iPhone 设置 → Wi-Fi
   - 找到并连接 Mac 创建的热点

3. **获取 Mac 热点 IP**：
   ```bash
   ifconfig | grep "inet " | grep -v 127.0.0.1
   ```
   通常热点 IP 是 `172.20.10.x` 或 `192.168.2.x`

4. **更新 App 配置**：
   在 `lib/core/services/api_config.dart` 中更新 IP：
   ```dart
   static const String baseUrl = 'http://172.20.10.1:8000'; // 使用热点 IP
   ```

5. **重启 App 测试**

### 方案 2：关闭路由器 AP 隔离

1. 登录路由器管理界面（通常是 `192.168.1.1` 或 `192.168.0.1`）
2. 找到"AP 隔离"、"客户端隔离"或"Station Isolation"设置
3. 关闭该功能
4. 保存并重启路由器
5. 重新连接 Wi-Fi 测试

### 方案 3：使用 USB 连接 + 端口转发（高级）

如果使用 USB 连接 iPhone，可以通过端口转发：

1. 在 Xcode 中，选择"Connect via Network"（通过 USB 连接时）
2. 使用 `iproxy` 工具进行端口转发：
   ```bash
   brew install libimobiledevice
   iproxy 8000 8000
   ```
3. 在 App 中使用 `http://127.0.0.1:8000`（因为端口已转发）

### 方案 4：使用 ngrok 创建公网隧道（临时方案）

如果需要快速测试，可以使用 ngrok：

1. 安装 ngrok：
   ```bash
   brew install ngrok
   ```

2. 创建隧道：
   ```bash
   ngrok http 8000
   ```

3. 使用 ngrok 提供的 URL（例如：`http://xxxx.ngrok.io`）

4. 在 App 中使用该 URL

## 验证网络连接

在 iPhone Safari 中测试：
- 访问：`http://[Mac IP]:8000/`
- 如果显示 `{"status":"ok"}`，说明网络正常
- 如果无法访问，说明是网络问题，不是 App 配置问题

## 当前配置

- Mac IP: `192.168.231.26`
- 后端端口: `8000`
- API 地址: `http://192.168.231.26:8000`

## 常见问题

**Q: 为什么模拟器可以连接，真机不行？**
A: 模拟器使用本地回环，真机需要真实的网络路由。

**Q: Safari 可以访问，但 App 不行？**
A: 检查 iPhone 设置 → 隐私与安全性 → 本地网络，确保 App 有权限。

**Q: 如何快速切换模拟器和真机？**
A: 在 `api_config.dart` 中准备两个配置，注释切换即可。


